<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•™å®¤è´´å›¾</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: "Microsoft YaHei", sans-serif; }
        #canvas-container { width: 100vw; height: 100vh; display: block; }
        
        #controls-panel {
            position: absolute;
            top: 10px; left: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            width: 260px;
            user-select: none;
        }
        h3 { margin: 0 0 15px 0; font-size: 18px; text-align: center; color: #333; }
        .control-group { margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #f0f0f0; }
        label { display: flex; align-items: center; font-size: 14px; margin-bottom: 8px; font-weight: bold; color: #444; }
        .color-dot { 
            width: 14px; height: 14px; border-radius: 4px; margin-right: 10px; 
            box-shadow: 0 0 2px rgba(0,0,0,0.3); 
        }
        input[type=file] { font-size: 12px; width: 100%; color: #666; }
        
        .dot-front { background: #55aaff; } 
        .dot-back  { background: #ffcc00; } 
        .dot-left  { background: #55ff55; } 
        .dot-right { background: #ff5555; } 
        .dot-top   { background: #333333; } 
        .dot-down  { background: #aaaaaa; } 
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <div id="controls-panel">
        <h3>ğŸ« æ•™å®¤è´´å›¾é¢æ¿</h3>
        <p style="font-size:12px; color:#666; margin-bottom:15px;">
            <b>æ­£å‰æ–¹ (è“)</b>ï¼šè®²å°/é»‘æ¿<br>
            <b>æ»šè½®</b>ï¼šç¼©æ”¾<br>
            <b>å·¦é”®</b>ï¼šæ—‹è½¬æŸ¥çœ‹
        </p>
        
        <div class="control-group">
            <label for="tex-front"><span class="color-dot dot-front"></span>è®²å°æ–¹å‘ (Front)</label>
            <input type="file" id="tex-front" accept="image/*">
        </div>
        <div class="control-group">
            <label for="tex-left"><span class="color-dot dot-left"></span>å·¦ä¾§å¢™ (Left)</label>
            <input type="file" id="tex-left" accept="image/*">
        </div>
        <div class="control-group">
            <label for="tex-right"><span class="color-dot dot-right"></span>å³ä¾§å¢™ (Right)</label>
            <input type="file" id="tex-right" accept="image/*">
        </div>
        <div class="control-group">
            <label for="tex-back"><span class="color-dot dot-back"></span>æ•™å®¤åå¢™ (Back)</label>
            <input type="file" id="tex-back" accept="image/*">
        </div>
        <div class="control-group">
            <label for="tex-floor"><span class="color-dot dot-down"></span>åœ°æ¿ (Floor)</label>
            <input type="file" id="tex-floor" accept="image/*">
        </div>
        <div class="control-group">
            <label for="tex-ceiling"><span class="color-dot dot-top"></span>å¤©èŠ±æ¿ (Ceiling)</label>
            <input type="file" id="tex-ceiling" accept="image/*">
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let scene, camera, renderer, controls;
        let roomMesh;
        const roomMaterials = []; 
        const textureLoader = new THREE.TextureLoader();

        const FACE_INDEX = {
            RIGHT: 0,
            LEFT: 1,
            TOP: 2,
            BOTTOM: 3,
            BACK: 4, 
            FRONT: 5 
        };

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x222222);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 0.01); 

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.rotateSpeed = -0.5; 
            controls.enablePan = false; 
            
            controls.enableZoom = true; 
            controls.zoomSpeed = 3.0; 
            controls.minDistance = 0.1; 
            
            // ä½ çš„è®¾å®šï¼š20.5ï¼Œè¶³å¤Ÿçœ‹æ¸…é•¿æ•™å®¤çš„å…¨è²Œ
            controls.maxDistance = 20.5; 

            controls.target.set(0, 0, 0); 
            controls.update();

            const axesHelper = new THREE.AxesHelper(5);
            scene.add(axesHelper);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambientLight);
        }

        function createRoom() {
            // --- å…³é”®ä¿®æ”¹ï¼šè°ƒæ•´ä¸ºæ•™å®¤é•¿æ–¹ä½“ ---
            // å®½ 10, é«˜ 5, æ·± 16
            // çœ‹èµ·æ¥åƒä¸€ä¸ªè¿›æ·±å¾ˆé•¿çš„é˜¶æ¢¯æ•™å®¤
            const geometry = new THREE.BoxGeometry(10, 5, 16);
            
            const colors = [
                0xff5555, // Right
                0x55ff55, // Left
                0x333333, // Top
                0xaaaaaa, // Bottom
                0xffcc00, // Back
                0x55aaff  // Front (è®²å°)
            ];

            for (let i = 0; i < 6; i++) {
                roomMaterials.push(new THREE.MeshBasicMaterial({
                    color: colors[i],
                    side: THREE.BackSide
                }));
            }

            roomMesh = new THREE.Mesh(geometry, roomMaterials);
            scene.add(roomMesh);
        }

        function setupUploader(inputId, materialIndex) {
            document.getElementById(inputId).addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    textureLoader.load(event.target.result, (texture) => {
                        texture.colorSpace = THREE.SRGBColorSpace;
                        
                        // åŸºç¡€ä¿®æ­£ï¼šBackSide éœ€é•œåƒç¿»è½¬
                        texture.wrapS = THREE.RepeatWrapping;
                        texture.repeat.x = -1; 
                        
                        // åœ°æ¿ä¿®æ­£ï¼šæ—‹è½¬ 180 åº¦
                        if (materialIndex === FACE_INDEX.BOTTOM) {
                            texture.center.set(0.5, 0.5); 
                            texture.rotation = Math.PI; 
                        }

                        const mat = roomMaterials[materialIndex];
                        mat.map = texture;
                        mat.color.set(0xffffff); 
                        mat.needsUpdate = true;
                    });
                };
                reader.readAsDataURL(file);
            });
        }

        setupUploader('tex-right', FACE_INDEX.RIGHT);
        setupUploader('tex-left',  FACE_INDEX.LEFT);
        setupUploader('tex-ceiling', FACE_INDEX.TOP);
        setupUploader('tex-floor', FACE_INDEX.BOTTOM);
        setupUploader('tex-back',  FACE_INDEX.BACK);
        setupUploader('tex-front', FACE_INDEX.FRONT);

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        init();
        createRoom();
        animate();

    </script>
</body>
</html>